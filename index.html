<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Joker Bet</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ðŸŽ² Joker Bet</h1>
<p class="subtitle">Cotes mises Ã  jour en direct</p>

<div id="cotes"></div>

<script src="config.js"></script>
<script>
let lastCotes = [];

async function loadCotes() {

  const query = `
    SELECT A, E
    WHERE A IS NOT NULL
    LIMIT 3
  `;

  const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/gviz/tq?sheet=${CONFIG.SHEET_NAME}&tq=${encodeURIComponent(query)}`;

  const res = await fetch(url);
  const text = await res.text();
  const json = JSON.parse(text.substr(47).slice(0, -2));
  const rows = json.table.rows;

  const labels = ["Victoire A", "Nul", "Victoire B"];
  let html = "";

  rows.forEach((r, i) => {
    const cote = r.c[1]?.v;
    const coteAffiche = cote ? cote.toFixed(2) : "â€”";

    let animClass = "";

    if (lastCotes[i] !== undefined && cote !== undefined) {
      if (cote > lastCotes[i]) animClass = "cote-up";
      if (cote < lastCotes[i]) animClass = "cote-down";
    }

    html += `
      <div class="card">
        <h3>${labels[i]}</h3>
        <p>
          Cote :
          <span class="cote ${animClass}">${coteAffiche}</span>
        </p>
      </div>
    `;

    lastCotes[i] = cote;
  });

  document.getElementById("cotes").innerHTML = html;
}

loadCotes();
setInterval(loadCotes, 5000);
</script>

</body>
</html>
